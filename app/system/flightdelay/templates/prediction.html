{% extends "base.html" %} {% load static %} {% block content %}
<div class="container-xxl flex-grow-1 container-p-y" x-data>
  <h4 class="py-3 breadcrumb-wrapper mb-4">
    <span class="text-muted fw-light">Data </span> Predictions
  </h4>
  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div
          class="card-header d-flex align-items-center justify-content-between"
        >
          <div class="d-flex align-items-center me-3">
            <div class="card-title mb-0">
              <h5 class="mb-0">Data Train</h5>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div
            class="spinner-border text-primary"
            role="status"
            x-show="$store.content.dataset.loading"
          >
            <span class="visually-hidden">Loading...</span>
          </div>

          <div
            class="table-responsive text-nowrap"
            x-cloak
            x-show="!$store.content.dataset.loading"
          >
            <table class="table" id="dtTrain">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>year</th>
                  <th>month</th>
                  <th>carrier</th>
                  <th>airport</th>
                  <th>arr_flights</th>
                  <th>arr_del15</th>
                  <th>carrier_ct</th>
                  <th>weather_ct</th>
                  <th>nas_ct</th>
                  <th>security_ct</th>
                  <th>late_aircraft_ct</th>
                  <th>arr_cancelled</th>
                  <th>arr_diverted</th>
                  <th>arr_delay</th>
                  <th>carrier_delay</th>
                  <th>weather_delay</th>
                  <th>nas_delay</th>
                  <th>security_delay</th>
                  <th>late_aircraft_delay</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="card mb-4">
        <div
          class="card-header d-flex align-items-center justify-content-between"
        >
          <div class="d-flex align-items-center me-3">
            <div class="card-title mb-0">
              <h5 class="mb-0">Data Test</h5>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div
            class="spinner-border text-primary"
            role="status"
            x-show="$store.content.dataset.loading"
          >
            <span class="visually-hidden">Loading...</span>
          </div>
          <div
            class="table-responsive text-nowrap"
            x-cloak
            x-show="!$store.content.dataset.loading"
          >
            <table class="table" id="dtTest">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>year</th>
                  <th>month</th>
                  <th>carrier</th>
                  <th>airport</th>
                  <th>arr_flights</th>
                  <th>arr_del15</th>
                  <th>carrier_ct</th>
                  <th>weather_ct</th>
                  <th>nas_ct</th>
                  <th>security_ct</th>
                  <th>late_aircraft_ct</th>
                  <th>arr_cancelled</th>
                  <th>arr_diverted</th>
                  <th>arr_delay</th>
                  <th>carrier_delay</th>
                  <th>weather_delay</th>
                  <th>nas_delay</th>
                  <th>security_delay</th>
                  <th>late_aircraft_delay</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-6">
      <div class="card mb-4">
        <div
          class="card-header d-flex align-items-center justify-content-between"
        >
          <div class="d-flex align-items-center me-3">
            <div class="card-title mb-0">
              <h5 class="mb-0">Linear Regression</h5>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div
            class="spinner-border text-primary"
            role="status"
            x-show="$store.content.LR.loading"
          >
            <span class="visually-hidden">Loading...</span>
          </div>

          <div x-cloak x-show="!$store.content.LR.loading">
            <div id="radialChartLR"></div>
          </div>

          <div x-cloak x-show="!$store.content.LR.loading">
            <ul class="p-0 m-0">
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Execution Time</p>
                  </div>
                  <div
                    class="item-progress"
                    id="LR.execution_time"
                    x-text="$store.content.LR.execution_time + ' seconds'"
                  ></div>
                </div>
              </li>
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Train Data Accuracy</p>
                  </div>
                  <div
                    class="item-progress"
                    id="LR.train_score"
                    x-text="$store.content.LR.train_score + ' %'"
                  ></div>
                </div>
              </li>
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Test Data Accuracy</p>
                  </div>
                  <div
                    class="item-progress"
                    id="LR.test_score"
                    x-text="$store.content.LR.test_score + ' %'"
                  ></div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="col-6">
      <div class="card mb-4">
        <div
          class="card-header d-flex align-items-center justify-content-between"
        >
          <div class="d-flex align-items-center me-3">
            <div class="card-title mb-0">
              <h5 class="mb-0">Decision Tree Regressor</h5>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div
            class="spinner-border text-primary"
            role="status"
            x-show="$store.content.DTR.loading"
          >
            <span class="visually-hidden">Loading...</span>
          </div>

          <div>
            <div x-cloak x-show="!$store.content.DTR.loading">
              <div id="radialChartDTR"></div>
            </div>

            <div x-cloak x-show="!$store.content.DTR.loading">
              <ul class="p-0 m-0">
                <li class="d-flex mb-4">
                  <div class="avatar avatar-sm flex-shrink-0 me-3">
                    <span class="avatar-initial rounded-circle bg-label-primary"
                      ><i class="bx bx-cube"></i
                    ></span>
                  </div>
                  <div
                    class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                  >
                    <div class="me-2">
                      <p class="mb-0 lh-1">Execution Time</p>
                    </div>
                    <div
                      class="item-progress"
                      id="DTR.execution_time"
                      x-text="$store.content.DTR.execution_time  + ' seconds'"
                    ></div>
                  </div>
                </li>
                <li class="d-flex mb-4">
                  <div class="avatar avatar-sm flex-shrink-0 me-3">
                    <span class="avatar-initial rounded-circle bg-label-primary"
                      ><i class="bx bx-cube"></i
                    ></span>
                  </div>
                  <div
                    class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                  >
                    <div class="me-2">
                      <p class="mb-0 lh-1">Train Data Accuracy</p>
                    </div>
                    <div
                      class="item-progress"
                      id="DTR.train_score"
                      x-text="$store.content.DTR.train_score + ' %'"
                    ></div>
                  </div>
                </li>
                <li class="d-flex mb-4">
                  <div class="avatar avatar-sm flex-shrink-0 me-3">
                    <span class="avatar-initial rounded-circle bg-label-primary"
                      ><i class="bx bx-cube"></i
                    ></span>
                  </div>
                  <div
                    class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                  >
                    <div class="me-2">
                      <p class="mb-0 lh-1">Test Data Accuracy</p>
                    </div>
                    <div
                      class="item-progress"
                      id="DTR.test_score"
                      x-text="$store.content.DTR.test_score + ' %'"
                    ></div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-6">
      <div class="card mb-4">
        <div
          class="card-header d-flex align-items-center justify-content-between"
        >
          <div class="d-flex align-items-center me-3">
            <div class="card-title mb-0">
              <h5 class="mb-0">Random Forest Regressor</h5>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div
            class="spinner-border text-primary"
            role="status"
            x-show="$store.content.RFR.loading"
          >
            <span class="visually-hidden">Loading...</span>
          </div>

          <div x-cloak x-show="!$store.content.RFR.loading">
            <div id="radialChartRFR"></div>
          </div>

          <div x-cloak x-show="!$store.content.RFR.loading">
            <ul class="p-0 m-0">
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Execution Time</p>
                  </div>
                  <div
                    class="item-progress"
                    id="RFR.execution_time"
                    x-text="$store.content.RFR.execution_time  + ' seconds'"
                  ></div>
                </div>
              </li>
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Train Data Accuracy</p>
                  </div>
                  <div
                    class="item-progress"
                    id="RFR.train_score"
                    x-text="$store.content.RFR.train_score + ' %'"
                  ></div>
                </div>
              </li>
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Test Data Accuracy</p>
                  </div>
                  <div
                    class="item-progress"
                    id="RFR.test_score"
                    x-text="$store.content.RFR.test_score + ' %'"
                  ></div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="col-6">
      <div class="card mb-4">
        <div
          class="card-header d-flex align-items-center justify-content-between"
        >
          <div class="d-flex align-items-center me-3">
            <div class="card-title mb-0">
              <h5 class="mb-0">Extra Trees Regressor</h5>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div
            class="spinner-border text-primary"
            role="status"
            x-show="$store.content.ETR.loading"
          >
            <span class="visually-hidden">Loading...</span>
          </div>

          <div x-cloak x-show="!$store.content.ETR.loading">
            <div id="radialChartETR"></div>
          </div>

          <div x-cloak x-show="!$store.content.ETR.loading">
            <ul class="p-0 m-0">
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Execution Time</p>
                  </div>
                  <div
                    class="item-progress"
                    id="ETR.execution_time"
                    x-text="$store.content.ETR.execution_time  + ' seconds'"
                  ></div>
                </div>
              </li>
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Train Data Accuracy</p>
                  </div>
                  <div
                    class="item-progress"
                    id="ETR.train_score"
                    x-text="$store.content.ETR.train_score + ' %'"
                  ></div>
                </div>
              </li>
              <li class="d-flex mb-4">
                <div class="avatar avatar-sm flex-shrink-0 me-3">
                  <span class="avatar-initial rounded-circle bg-label-primary"
                    ><i class="bx bx-cube"></i
                  ></span>
                </div>
                <div
                  class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2"
                >
                  <div class="me-2">
                    <p class="mb-0 lh-1">Test Data Accuracy</p>
                  </div>
                  <div
                    class="item-progress"
                    id="ETR.test_score"
                    x-text="$store.content.ETR.test_score + ' %'"
                  ></div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <div class="d-flex align-items-center me-3">
            <div class="card-title mb-0">
              <h5 class="mb-0">Bar Chart</h5>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div
            class="spinner-border text-primary"
            role="status"
            x-show="$store.content.barChart.loading"
          >
            <span class="visually-hidden">Loading...</span>
          </div>
          <div x-cloak x-show="!$store.content.barChart.loading">
            <div id="barChart"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %} {% block js %}
<script>
  document.addEventListener("alpine:init", () => {
    Alpine.store("content", {
      dataset: {
        dummy: "xyz",
        loading: true,
      },
      LR: {
        loading: true,
        execution_time: "",
        train_score: "",
        test_score: "",
      },
      RFR: {
        loading: true,
        execution_time: "",
        train_score: "",
        test_score: "",
      },
      ETR: {
        loading: true,
        execution_time: "",
        train_score: "",
        test_score: "",
      },
      DTR: {
        loading: true,
        execution_time: "",
        train_score: "",
        test_score: "",
      },
      barChart: {
        loading: true,
      },
    });
  });

  window.addEventListener("DOMContentLoaded", (event) => {
    // showTrainTest();
    // predictLR();
    // predictDTR();
    // predictRFR();
    // predictETR();

    showTrainTest()
      .then(predictLR)
      .then(predictDTR)
      .then(predictRFR)
      .then(predictETR)
      .then(barChart);
  });

  const loadJsonSplitData = () => {
    const url = "{% url 'json_split_data' %}";
    return axios.get(url).then((response) => response);
  };

  const predict = (type) => {
    const url = `{% url 'json_predict' %}?type=${type}`;
    return axios.get(url).then((response) => {
      console.log(response);
      return Promise.resolve(response);
    });
  };

  const decimalToPercentage = (decimal) => {
    return decimal * 100;
  };

  const showTrainTest = () => {
    return loadJsonSplitData()
      .then((response) => {
        $("#dtTrain").DataTable({
          data: response.data.data_train,
          deferRender: true,
          columns: [
            { data: "id" },
            { data: "year" },
            { data: "month" },
            { data: "carrier" },
            { data: "airport" },
            { data: "arr_flights" },
            { data: "arr_del15" },
            { data: "carrier_ct" },
            { data: "weather_ct" },
            { data: "nas_ct" },
            { data: "security_ct" },
            { data: "late_aircraft_ct" },
            { data: "arr_cancelled" },
            { data: "arr_diverted" },
            { data: "arr_delay" },
            { data: "carrier_delay" },
            { data: "weather_delay" },
            { data: "nas_delay" },
            { data: "security_delay" },
            { data: "late_aircraft_delay" },
          ],
        });
        $("#dtTest").DataTable({
          data: response.data.data_test,
          deferRender: true,
          columns: [
            { data: "id" },
            { data: "year" },
            { data: "month" },
            { data: "carrier" },
            { data: "airport" },
            { data: "arr_flights" },
            { data: "arr_del15" },
            { data: "carrier_ct" },
            { data: "weather_ct" },
            { data: "nas_ct" },
            { data: "security_ct" },
            { data: "late_aircraft_ct" },
            { data: "arr_cancelled" },
            { data: "arr_diverted" },
            { data: "arr_delay" },
            { data: "carrier_delay" },
            { data: "weather_delay" },
            { data: "nas_delay" },
            { data: "security_delay" },
            { data: "late_aircraft_delay" },
          ],
        });
      })
      .then(() => {
        Alpine.store("content").dataset.loading = false;
      });
  };
  const predictLR = () => {
    return predict("LR").then((response) => {
      Alpine.store("content").LR.train_score = response.data.train_score;
      Alpine.store("content").LR.test_score = response.data.test_score;
      Alpine.store("content").LR.loading = false;
      radialChart(
        document.querySelector("#radialChartLR"),
        response.data.test_score
      );
      Alpine.store("content").LR.execution_time = response.data.execution_time;
      Alpine.store("content").LR.train_score = response.data.train_score;
      Alpine.store("content").LR.test_score = response.data.test_score;
    });
  };
  const predictDTR = () => {
    return predict("DTR").then((response) => {
      Alpine.store("content").DTR.train_score = response.data.train_score;
      Alpine.store("content").DTR.test_score = response.data.test_score;
      Alpine.store("content").DTR.loading = false;
      radialChart(
        document.querySelector("#radialChartDTR"),
        response.data.test_score
      );
      Alpine.store("content").DTR.execution_time = response.data.execution_time;
      Alpine.store("content").DTR.train_score = response.data.train_score;
      Alpine.store("content").DTR.test_score = response.data.test_score;
    });
  };
  const predictRFR = () => {
    return predict("RFR").then((response) => {
      Alpine.store("content").RFR.train_score = response.data.train_score;
      Alpine.store("content").RFR.test_score = response.data.test_score;
      Alpine.store("content").RFR.loading = false;
      radialChart(
        document.querySelector("#radialChartRFR"),
        response.data.test_score
      );
      Alpine.store("content").RFR.execution_time = response.data.execution_time;
      Alpine.store("content").RFR.train_score = response.data.train_score;
      Alpine.store("content").RFR.test_score = response.data.test_score;
    });
  };
  const predictETR = () => {
    return predict("ETR").then((response) => {
      Alpine.store("content").ETR.train_score = response.data.train_score;
      Alpine.store("content").ETR.test_score = response.data.test_score;
      Alpine.store("content").ETR.loading = false;
      radialChart(
        document.querySelector("#radialChartETR"),
        response.data.test_score
      );
      Alpine.store("content").ETR.execution_time = response.data.execution_time;
      Alpine.store("content").ETR.train_score = response.data.train_score;
      Alpine.store("content").ETR.test_score = response.data.test_score;
    });
  };

  const barChart = () => {
    Alpine.store("content").barChart.loading = false;

    let test_score = [
      Alpine.store("content").LR.test_score,
      Alpine.store("content").DTR.test_score,
      Alpine.store("content").RFR.test_score,
      Alpine.store("content").ETR.test_score,
    ];
    let train_score = [
      Alpine.store("content").LR.train_score,
      Alpine.store("content").DTR.train_score,
      Alpine.store("content").RFR.train_score,
      Alpine.store("content").ETR.train_score,
    ];

    let o, e, r, t, a, s;
    s =
      ((o = config.colors.cardColor),
      (e = config.colors.headingColor),
      (r = config.colors.textMuted),
      (t = config.colors.bodyColor),
      (a = config.colors.borderColor),
      "light");
    var i = document.querySelector("#barChart"),
      l = {
        chart: { height: 250, type: "bar", toolbar: { show: !1 } },
        plotOptions: {
          bar: {
            horizontal: !1,
            columnWidth: "20%",
            borderRadius: 3,
            startingShape: "rounded",
          },
        },
        dataLabels: { enabled: !1 },
        colors: [config.colors.primary, config.colors_label.primary],
        series: [
          { name: "Test Score", data: test_score },
          { name: "Train Score", data: train_score },
        ],
        grid: { borderColor: a, padding: { bottom: -8 } },
        xaxis: {
          categories: [
            "Linear Regression",
            "Decision Tree Regressor",
            "Random Forest Regressor",
            "Extra Trees Regressor",
          ],
          axisBorder: { show: !1 },
          axisTicks: { show: !1 },
          labels: { style: { colors: r } },
        },
        yaxis: {
          min: 0,
          max: 100,
          tickAmount: 3,
          labels: { style: { colors: r } },
        },
        legend: { show: !1 },
        tooltip: {
          y: {
            formatter: function (o) {
              return o + " %";
            },
          },
        },
      };
    null !== i && new ApexCharts(i, l).render();
  };

  const radialChart = (element, percentage) => {
    let o, e, r, t, a, s;
    s =
      ((o = config.colors.cardColor),
      (e = config.colors.headingColor),
      (r = config.colors.textMuted),
      (t = config.colors.bodyColor),
      (a = config.colors.borderColor),
      "light");
    var i = element,
      l = {
        chart: {
          height: 500,
          fontFamily: "IBM Plex Sans",
          type: "radialBar",
          sparkline: { show: !0 },
        },
        grid: { show: !1, padding: { top: -25 } },
        plotOptions: {
          radialBar: {
            size: 100,
            startAngle: -135,
            endAngle: 135,
            offsetY: 10,
            hollow: { size: "55%" },
            track: { strokeWidth: "50%", background: o },
            dataLabels: {
              value: {
                offsetY: -15,
                color: e,
                fontFamily: "Rubik",
                fontWeight: 500,
                fontSize: "26px",
              },
              name: { fontSize: "15px", color: t, offsetY: 24 },
            },
          },
        },
        colors: [config.colors.danger],
        fill: {
          type: "gradient",
          gradient: {
            shade: "dark",
            type: "horizontal",
            shadeIntensity: 0.5,
            gradientToColors: [config.colors.primary],
            inverseColors: !0,
            opacityFrom: 1,
            opacityTo: 1,
            stops: [0, 100],
          },
        },
        stroke: { dashArray: 3 },
        series: [percentage],
        labels: ["Test Accuracy"],
      };
    null !== i && new ApexCharts(i, l).render();
  };
</script>
{% endblock js%}
